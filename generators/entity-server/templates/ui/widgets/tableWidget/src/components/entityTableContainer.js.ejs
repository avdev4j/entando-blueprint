<%# { "useBluePrint": true, "renameTo": "`/${generator.entityInstance}/tableWidget/src/components/${generator.entityClass}TableContainer.js`" } -%>
import React, {PureComponent} from 'react';
import PropTypes from 'prop-types';
import i18next from 'i18next';
import <%= entityClass %>Table from 'components/<%= entityClass %>Table';
import <%= entityInstancePlural %>Get from 'api/<%= entityInstancePlural %>';
import Notification from 'components/common/Notification';
import { ThemeProvider } from '@material-ui/styles';
import { createMuiTheme } from '@material-ui/core';

<%_ const ComponentName = `${entityClass}TableContainer`; _%>
export default class <%= ComponentName %> extends PureComponent {
  theme = createMuiTheme();

  state = {
      <%= entityInstancePlural %>: [],
      notificationStatus: null,
      notificationMessage: null,
  };

  async componentDidMount() {
    try {
      const json = await <%= entityInstancePlural %>Get();

      const <%= entityInstancePlural %> = json.map(<%= entityInstance %> => ({
        ...<%= entityInstance %>,
      }));
      this.setState({
        <%= entityInstancePlural %>,
        notificationStatus: null,
        notificationMessage: null,
      });
    } catch (err) {
      this.handleError(err);
    }
  }

  closeNotification = () => {
    this.setState({error: null});
  };

  handleError(err) {
    const {onError} = this.props;
    onError(err);
    this.setState({
      notificationStatus: 'error',
      notificationMessage: i18next.t('common.couldNotFetchData'),
    });
  }

  render() {
    const {notificationStatus, notificationMessage, <%= entityInstancePlural %>} = this.state;
    const {onSelect} = this.props;
    return (
      <ThemeProvider theme={this.theme}>
        <<%= entityClass %>Table <%= entityInstancePlural %>={<%= entityInstancePlural %>} onSelect={onSelect}/>
        <Notification
          status={notificationStatus}
          message={notificationMessage}
          onClose={this.closeNotification}
        />
      </ThemeProvider>
    );
  }
}

<%= ComponentName %>.propTypes = {
  onError: PropTypes.func,
  onSelect: PropTypes.func,
};

<%= ComponentName %>.defaultProps = {
  onError: () => {
  },
  onSelect: () => {
  },
};
